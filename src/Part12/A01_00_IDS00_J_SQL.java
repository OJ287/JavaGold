package Part12;

/**
 * @author liyanpeng
 * @date 2025/5/10
 * @description TODO
 */

import Part10.DbConnector;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

/**
 * Java Gold å‡ºé¢˜ä¸ä¼šè€ƒéå¸¸æ·±å…¥çš„æ”»å‡»æ„é€ ï¼Œä½†ä¼šé—®ä½ â€œå“ªæ®µå†™æ³•æ›´å®‰å…¨â€â€œå¦‚ä½•é˜²æ­¢æ³¨å…¥â€ï¼Œç™½åå•ã€æ ‡å‡†APIã€ä¸å¯å˜æ€§ã€æœ€å°æƒé™åŸåˆ™æ˜¯ç­”é¢˜å…³é”®ã€‚
 * âœ…âœ…âœ…æ¨èå¤šç»ƒå¸¦æœ‰é™·é˜±ä»£ç çš„åˆ¤æ–­é¢˜ï¼Œæ³¨é‡ PreparedStatementã€try-with-resourcesã€escape å¤„ç†æ–¹å¼ã€‚
 * âœ…âœ…âœ…è¿˜æœ‰ä¸€èˆ¬ä¸è¦ä½¿ç”¨SimpleDataï¼Œè€Œæ˜¯ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„DataTimeFormatter
 * <p>
 * <p>
 * <p>
 * ğŸ” ãƒˆãƒ”ãƒƒã‚¯ï¼šæ”»å‡»å¯èƒ½æ€§ä»£ç ä¸é˜²æ­¢ä¾‹
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ ãƒˆãƒ”ãƒƒã‚¯   â”‚ æ”»å‡»å¯èƒ½æ€§ä»£ç ä¾‹          â”‚ é˜²æ­¢è¢«æ”»å‡»çš„å¼€å‘ä¾‹                         â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ SQLæ³¨å…¥    â”‚ Statement stmt =           â”‚ PreparedStatement pstmt =                â”‚
 * â”‚            â”‚ stmt.execute("SELECT *...");â”‚ pstmt.setString(1, userInput);           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ã‚³ãƒãƒ³ãƒ‰æ³¨å…¥â”‚ Runtime.getRuntime().exec()â”‚ new ProcessBuilder(args).start();        â”‚
 * â”‚            â”‚ with user input             â”‚ ä¸”å…ˆåšç™½åå•éªŒè¯                           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ XSS        â”‚ out.println(userInput);     â”‚ out.println(escapeHtml(userInput));      â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ è·¯å¾„éå†   â”‚ new File("/dir/" + input)  â”‚ Paths.get("/dir").resolve(input).normalizeâ”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ååºåˆ—åŒ–æ”»å‡»â”‚ ObjectInputStream.readObjectâ”‚ ä½¿ç”¨ç™½åå•ç±»ï¼Œé¿å…ååºåˆ—åŒ–éä¿¡ä»»æ•°æ®      â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ä¿¡æ¯æ³„éœ²   â”‚ e.printStackTrace();        â”‚ è®°å½•åˆ°å®‰å…¨æ—¥å¿—ï¼Œè¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯           â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * <p>
 * <p>
 * ğŸ§¼ å‡ºå…¥åŠ›æ£€æŸ¥ä¸æ— å®³åŒ–
 * ğŸ“Œ å®šä¹‰è¯´æ˜ï¼š
 * å…¥åŠ›æ£€æŸ¥ï¼ˆInput Validationï¼‰ï¼šéªŒè¯ç”¨æˆ·è¾“å…¥æ˜¯å¦ç¬¦åˆç³»ç»Ÿé¢„æœŸï¼ˆæ ¼å¼ã€ç±»å‹ã€é•¿åº¦ç­‰ï¼‰ã€‚
 * æ•°æ®æ— å®³åŒ–ï¼ˆSanitization / Neutralizationï¼‰ï¼šå°†æ½œåœ¨æœ‰å®³çš„æ•°æ®è½¬åŒ–ä¸ºæ— å®³å½¢å¼ï¼ˆå¦‚ <script> è½¬ä¹‰ç­‰ï¼‰ã€‚
 * <p>
 * âœ… è¾“å…¥éªŒè¯å…¸å‹æ–¹å¼
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ éªŒè¯æ–¹å¼                   â”‚ è¯´æ˜                                           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ æ­£åˆ™è¡¨è¾¾å¼                 â”‚ userInput.matches("[a-zA-Z0-9]{4,12}")         â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ç±»å‹éªŒè¯                   â”‚ Integer.parseInt(), EmailValidatorç­‰          â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆç™½åå•æ–¹å¼ï¼‰â”‚ Arrays.asList("admin", "user").contains(input)â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * <p>
 * ğŸ§½ æ— å®³åŒ–æ–¹æ³•ä¸€è§ˆ
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ æ— å®³åŒ–æ–¹æ³•                     â”‚ è¯´æ˜                                        â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ HTML Escaping                  â”‚ Apache Commons Text: StringEscapeUtils      â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ SQLå‚æ•°åŒ–å¤„ç†                  â”‚ PreparedStatement / MyBatis bindæ–¹å¼        â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ã‚³ãƒãƒ³ãƒ‰ç”¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—           â”‚ ProcessBuilder ä¸ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ ãƒ‘ã‚¹æ­£è¦åŒ–                     â”‚ Path#normalize(), Files#isDirectory ç­‰ç¡®è®¤   â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * <p>
 * é˜²æ­¢SQLæ³¨å…¥é£é™©çš„æ–¹æ³•
 * 1.å…¥åŠ›å€¼çš„å¦¥å½“æ€§è¿›è¡Œæ£€æŸ¥ã€‚æ–‡å­—æ•°ï¼Œé™åˆ¶ç¬¦å·è¾“å…¥ï¼Œæ•°å­—ç­‰
 * 2.ä½¿ç”¨PreparedStatementçš„å ä½ç¬¦è¿›è¡Œè®¾ç½®å‚æ•°
 */
public class A01_00_IDS00_J_SQL {
    // è‡ªåŠ¨ç”Ÿæˆ main æ–¹æ³•
    public static void main(String[] args) {
        // TODO
        /**
         * mysql> select * from user;
         * +---------+-----------+---------------+
         * | user_id | user_name | user_password |
         * +---------+-----------+---------------+
         * | T100    | hana      | hana123       |
         * | T200    | taro      | taro888       |
         * +---------+-----------+---------------+
         * 2 rows in set (0.00 sec)
         */
        /**
         * å¦‚æœç”¨æˆ·ç•Œé¢è¾“å…¥user_idæ˜¯T100' OR '1'='1çš„è¯
         * è€Œä¸”ä¸ä½¿ç”¨PreparedStatementè€Œæ˜¯ç›´æ¥ä½¿ç”¨sqlæ‹¼æ¥çš„è¯å°±ä¼šè¢«æ³¨å…¥
         * UPDATE user set user_password='hana1234' where user_id = ''
         * UPDATE user set user_password='hana1234' where user_id = 'T100' OR '1'='1'
         */
//        String sql = "UPDATE user set " +
//                "user_password=" + user_password +
//                "where user_id = " + user_id;

        String sql = "UPDATE user set " +
                "user_password= ? " +
                "where user_id = ?";

        try (Connection con = DbConnector.getConnect();
             PreparedStatement pstmt = con.prepareStatement(sql)) {
            pstmt.setString(1, "hana123");
            pstmt.setString(2, "T100");
//            pstmt.setString(1, "T100' OR '1'='1");//æ²¡é—®é¢˜ï¼ŒPreparedStatementä¼šæŠŠT100' OR '1'='1è®¤æˆä¸€ä¸ªå­—ç¬¦ä¸²
            // å¯¹é‡Œé¢çš„å•å¼•å·è½¬æˆä¸¤ä¸ªå•å¼•å·
            // UPDATE user SET user_password='hana1234' WHERE user_id = 'T100'' OR ''1''=''1'
            int col = pstmt.executeUpdate();
            System.out.println("col : " + col);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}